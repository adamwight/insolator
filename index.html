<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>

<script type="text/javascript" src="contrib/util.js"></script>
<script type="text/javascript" src="contrib/math.js"></script>
<script type="text/javascript" src="contrib/datetime.js"></script>
<script type="text/javascript" src="contrib/observer.js"></script>
<script type="text/javascript" src="contrib/planets.js"></script>
<script type="text/javascript" src="contrib/sun.js"></script>

<script type="text/javascript" src="contrib/rt.js"></script>

<script type="text/javascript" src="gray64.js"></script>

<script type="text/javascript" language="JavaScript">
/*
 * TODO
 *  location and viewpoint pickers
 *  animation
 *  object selection using reverse ray intersection & Z depth expansion
 */
argstr = location.search.substring(1,location.search.length);

generate_scene_objects = function()
{
    //bilinear = getl("bicheck").checked;
    var bitfunc = bilinear ? bitmap_bi : bitmap;
    var tilefunc = bilinear ? tilebitmap_bi : tilebitmap;
    
    plane(0,-70,0, 0,-70,-100, -200,-70,0, 1, 0.6,1.0,32, 0.4).
            setuv(300,0,0, 0,0,300, 0,0, tilefunc).setbitmap("textures/onix-pina.jpg");
    
    disc(0,60,140,	0,0,-1,		150, 1, 0.5,1.0,64, 0.6).		// far
            setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");
    //open_floor(1,	1, 0.5,1.0,64, 0.6).
            //setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");
    //open_floor(2,	1, 0.5,1.0,64, 0.6).
            //setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");
    //open_floor(3,	1, 0.5,1.0,64, 0.6).
            //setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");

  update_sun();
};

putpixel = function(x, y, pcl)
{
    var cur = (pcl>1)?255:(pcl*255|0);
    var sum = film.expose(x, y, cur);
    return cur;
    //return sum;
};

$(document).ready(function() {
  film = new Gray64(320, 256);
  $("#season").slider({
    max: 366,
    step: 1,
    start:function() {
      anim = false;
    },
    slide:function() {
      day = $(this).slider("value");
      update_sun();
      draw_sun();
    },
    stop:function() {
      renderframe();
    },
  });

  $("#hours").slider({
    max: 24,
    step: 0.1,
    start:function() {
      anim = false;
    },
    slide:function() {
      hour = $(this).slider("value");
      update_sun();
      draw_sun();
    },
    stop:function() {
      renderframe();
    },
  });
  /*$("input[name=civil_time]").change(function() {
    $("#hour").value($(this).);
  });*/
  anim=false;
  year_began = new Date("Jan 01 "+new Date().getFullYear()+" 00:00:00").getTime();
  //year_began -= new Date().getTimezoneOffset() * 60 * 1000;
  day = Math.floor(
    (new Date().getTime() - year_began) / (24 * 3600 * 1000)
  );
  hour = (new Date().getTime() - (year_began + day * (24 * 3600 * 1000))) / (3600 * 1000);
  update_sliders();
  update_sun();
  load(); /* initialize raytracer */

  $("#canvdiv").resizable({
    stop: function() {
      var w = $(this).width();
      var h = $(this).height();
      film = new Gray64(w, h);
      changesize(w, h);
    }
  });
});
function update_sliders()
{
  $("#hours").slider("value", hour);
  $("#season").slider("value", day);
}
function update_sun()
{
  //var t = day + (hour + framenum) * (1000 * 3600);
  var t = year_began + day * (1000 * 3600 * 24) + hour * (1000 * 3600);
  //var t = new Date().getTime() + framenum * 1000 * 3600;
  reset1(new Date(t));
  //alert(local_sidereal(observer));
  var sun_altaz = get_sun(observer);
  var m_pi = 3.141592654/180;
  //alert(sun_altaz[1]);
  var x = 200 * Math.cos(sun_altaz[0] * m_pi) * Math.sin(sun_altaz[1] * m_pi);
  var z = 200 * Math.cos(sun_altaz[0] * m_pi) * Math.cos(sun_altaz[1] * m_pi);
  var y = 200 * Math.sin(sun_altaz[0] * m_pi);
  var intensity = 1.0;
  li = new Array();
  numli = 0;
  light(x, y, z, intensity);
}
function draw_sun()
{
  var l = li[0];
  var screen = transform(l.x, l.y, l.z, 0);
  ctx.fillStyle = 'red';
  ctx.beginPath();
  var foreshortening = 1;
  ctx.arc(foreshortening * screen.x + wid / 2, foreshortening * (-screen.y) + hei / 2, 5, 0, Math.PI*2, true);
  ctx.closePath();
  ctx.fill();
}
</script>

<style type="text/css">
body {
	/*background-color: #000;*/
	/*color			: #fff;*/
	font-family		: verdana;
	line-height		: 18px;
}
table {
	font-family		: verdana;
	line-height		: 18px;
}
canvas {
	border			: 1px solid #fff;
}
input {
	line-height		: 16px;
	border			: 1px solid;
	padding			: 0px;
	margin			: 2px;
}

#render-wrapper {
    display: block;
    clear: none;
    float: left;
    margin: 10px;
}

#time {
    display: block;
    float: right;
    margin: 10px;
}

#hours-wrapper {
    text-align: center;
    padding: 15px;
}

.ui-slider-handle[href="#"] {
  background: transparent url("images/bead1.png");
  background-size: 100%;
  width: 34px;
  height: 44px;
  border: none;
}

.ui-widget {
  border: none;
}

#hours-wrapper .ui-slider-horizontal {
  background-color: transparent;
  background-image: url("images/coil.png");
  background-size: 100%;
  background-position: 0% 50%;
  height: 32px;
}

.ui-slider {
  background: none;
}

#season-sibling {
  background-color: transparent;
  background-image: url("images/robostalk.png");
  background-size: 100%;
  background-position: 50% 50%;
  background-overflow: visible;
  background-repeat: no-repeat;
  height: 251px;
  width: 100%;
  margin-top: -125px;
  /*padding-top: 115px;*/
  clear: none;
  float: left;
}
</style>

</head>

<body>

<div id=render-wrapper>
<!--	Anti-alias: <input onchange="changeaa()" id="aacheck" type="checkbox">-->
<!--	Bilinear Filter: <input type=checkbox id="bicheck" />-->

<table border="0" cellpadding="0" cellspacing="0">
<tbody><tr>
<td valign="top">
	<br> <!-- 400 x 450      800x640    600x480-->
	<div id="canvdiv" style="width: 320px; height: 256px; border: 1px solid rgb(0, 0, 0); left: 0px;">
		<canvas id="canv" width="320" height="256"></canvas>
	</div><br>
	Viewpoint 
	x:<input value="-85" size="6" id="xangle" type="text">
	y:<input value="90" size="6" id="yangle" type="text">
	z:<input value="-260" size="6" id="zangle" type="text">
	<button onclick="randomview()">Random</button><br><br>
	<button onclick="load()">Render</button><br><br>
	<div id="progress">Idle</div>
	<div id="progress2">&nbsp;</div>
	<div id="msg">&nbsp;</div>
	<div id="dbg">&nbsp;</div>
</td>
</tr></tbody></table>
</div>

<div id="time">
<form name="table1" action="javascript:void 0;">
<h3>Date and time at location for observations</h3>
Date <INPUT type="text" size="10" name="local_date"
value="" onchange="updatelocal(false)">
Civil Time <INPUT type="text" size="8" name= "civil_time" value="" onchange="updatelocal(false)">

<div id="hours-wrapper">Noon
  <div id="hours"></div>
</div>
<div>
  <span style="">Jan 1st</span>
  <span style="float: right; display: block;">Dec 31st</span>
  <div id="season-sibling"></div>
  <div id="season" style="display:block;"></div>
</div>

<h3>Location for observations</h3>
Select from this list or enter below
<!-- The Place select is altered below by JavaScript -->
<select name="Place" onchange= "updateplace()">
<option>Select your home location</option>
<option>unknown</option>
</select>
<br>
Name <input type="text" size="20" name="place_name" onchange="updatename()">
 <select name="North" onchange="updatell()">
 <option>North</option>
 <option>South</option>
 </select>
 <input type="text" size="9" name="Latitude" onchange="updatell()">
 <select name="West" onchange="updatell()">
 <option>West</option>
 <option>East</option>
 </select>
 <input type="text" size="9" name="Longitude" onchange="updatell()">

</form>
</div>


</body></html>
