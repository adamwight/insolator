<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script type="text/javascript" src="util.js"></script>
<script type="text/javascript" src="math.js"></script>
<script type="text/javascript" src="datetime.js"></script>
<script type="text/javascript" src="observer.js"></script>
<script type="text/javascript" src="planets.js"></script>
<script type="text/javascript" src="sun.js"></script>

<script type="text/javascript" src="rt.js"></script>

<script type="text/javascript" src="gray64.js"></script>

<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>

<script type="text/javascript" language="JavaScript">
argstr = location.search.substring(1,location.search.length);

generate_scene_objects = function()
{
    //bilinear = getl("bicheck").checked;
    var bitfunc = bilinear ? bitmap_bi : bitmap;
    var tilefunc = bilinear ? tilebitmap_bi : tilebitmap;
    
    plane(0,-70,0, 0,-70,-100, -200,-70,0, 1, 0.6,1.0,32, 0.4).
            setuv(300,0,0, 0,0,300, 0,0, tilefunc).setbitmap("textures/onix-pina.jpg");
    
    disc(0,60,140,	0,0,-1,		150, 1, 0.5,1.0,64, 0.6).		// far
            setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");
    //open_floor(1,	1, 0.5,1.0,64, 0.6).
            //setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");
    //open_floor(2,	1, 0.5,1.0,64, 0.6).
            //setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");
    //open_floor(3,	1, 0.5,1.0,64, 0.6).
            //setuv(300,0,0, 0,300,0, 0.5,0.5, bitfunc).setbitmap("textures/onix-pina.jpg");

  update_sun();
};

putpixel = function(x, y, pcl)
{
    var cur = (pcl>1)?255:(pcl*255|0);
    var sum = film.expose(x, y, cur);
    return cur;
    //return sum;
};

$(document).ready(function() {
  film = new Gray64(320, 256);
  $("#season").slider({
    max: 366,
    step: 1,
    start:function() {
      anim = false;
    },
    slide:function() {
      day = $(this).slider("value");
      update_sun();
      draw_sun();
    },
    stop:function() {
      renderframe();
    },
  });

  $("#hours").slider({
    max: 24,
    step: 0.1,
    start:function() {
      anim = false;
    },
    slide:function() {
      hour = $(this).slider("value");
      update_sun();
      draw_sun();
    },
    stop:function() {
      renderframe();
    },
  });
  /*$("input[name=civil_time]").change(function() {
    $("#hour").value($(this).);
  });*/
  anim=false;
  year_began = new Date("Jan 01 "+new Date().getFullYear()+" 00:00:00").getTime();
  //year_began -= new Date().getTimezoneOffset() * 60 * 1000;
  day = Math.floor(
    (new Date().getTime() - year_began) / (24 * 3600 * 1000)
  );
  hour = (new Date().getTime() - (year_began + day * (24 * 3600 * 1000))) / (3600 * 1000);
  update_sliders();
  update_sun();
  load(); /* initialize raytracer */
});
function update_sliders()
{
  $("#hours").slider("value", hour);
  $("#season").slider("value", day);
}
function update_sun()
{
  //var t = day + (hour + framenum) * (1000 * 3600);
  var t = year_began + day * (1000 * 3600 * 24) + hour * (1000 * 3600);
  //var t = new Date().getTime() + framenum * 1000 * 3600;
  reset1(new Date(t));
  //alert(local_sidereal(observer));
  var sun_altaz = get_sun(observer);
  var m_pi = 3.141592654/180;
  //alert(sun_altaz[1]);
  var x = 200 * Math.cos(sun_altaz[0] * m_pi) * Math.sin(sun_altaz[1] * m_pi);
  var z = 200 * Math.cos(sun_altaz[0] * m_pi) * Math.cos(sun_altaz[1] * m_pi);
  var y = 200 * Math.sin(sun_altaz[0] * m_pi);
  var intensity = 1.0;
  li = new Array();
  numli = 0;
  light(x, y, z, intensity);
}
function draw_sun()
{
  var l = li[0];
  var screen = transform(l.x, l.y, l.z, 0);
  ctx.fillStyle = 'red';
  ctx.beginPath();
  var foreshortening = 1;
  ctx.arc(foreshortening * screen.x + wid / 2, foreshortening * (-screen.y) + hei / 2, 5, 0, Math.PI*2, true);
  ctx.closePath();
  ctx.fill();
}
</script>

<style type="text/css">
body {
	/*background-color: #000;*/
	/*color			: #fff;*/
	font-family		: verdana;
	line-height		: 18px;
}
table {
	font-family		: verdana;
	line-height		: 18px;
}
canvas {
	border			: 1px solid #fff;
}
input {
	line-height		: 16px;
	border			: 1px solid #fff;
	padding			: 0px;
	margin			: 2px;
}
</style>

</head>

<body>
Size: <select onchange="changesize()" id="sizesel">
		<option value="100x80">100x80</option>
		<option value="200x160">200x160</option>
		<option value="320x256" selected="selected">320x256</option>
		<option value="400x320">400x320</option>
		<option value="500x400">500x400</option>
		<option value="640x512">640x512</option>
		<option value="800x640">800x640</option>
		<option value="1200x960">1200x960</option>
		<option value="1680x1050">1680x1050 (URMENTAL!)</option>
	</select>
	Anti-alias: <input onchange="changeaa()" id="aacheck" type="checkbox">
<!--	Bilinear Filter: <input type=checkbox id="bicheck" />-->

<table border="0" cellpadding="0" cellspacing="0">
<tbody><tr>
<td align="center" valign="top">
	<br> <!-- 400 x 450      800x640    600x480-->
	<div id="canvdiv" style="width: 320px; height: 256px; border: 1px solid rgb(0, 0, 0); left: 0px;">
		<canvas id="canv" width="320" height="256"></canvas>
	</div><br>
	Viewpoint 
	x:<input value="-85" size="6" id="xangle" type="text">
	y:<input value="90" size="6" id="yangle" type="text">
	z:<input value="-260" size="6" id="zangle" type="text">
	<button onclick="randomview()">Random</button><br><br>
	<button onclick="load()">Render</button><br><br>
	<div id="progress">Idle</div>
	<div id="progress2">&nbsp;</div>
	<div id="msg">&nbsp;</div>
	<div id="dbg">&nbsp;</div>
</td>
</tr></tbody></table>

<div id="hours"></div>
<br>
<div id="season"></div>

<form name="table1" action="javascript:void 0;">
<table class="bluebox" border="1" cellpadding="5">
<tr>
<th colspan="3">Location for observations</th>
<tr>
<td align="center" colspan="2">Select&nbsp;from&nbsp;this&nbsp;list&nbsp;or&nbsp;enter&nbsp;below</td>
<td align="center">
<!-- The Place select is altered below by JavaScript -->
<select name="Place" onchange= "updateplace()">
<option>Select your home location</option>
<option>unknown</option>
</select></td>
</tr>
<tr>
<td align="left">Name <input type="text" size="20" name="place_name" onchange="updatename()"></td>
<td align="center">
 <select name="North" onchange="updatell()">
 <option>North</option>
 <option>South</option>
 </select>
 <input type="text" size="9" name="Latitude" onchange="updatell()">
</td>
<td align="center">
 <select name="West" onchange="updatell()">
 <option>West</option>
 <option>East</option>
 </select>
 <input type="text" size="9" name="Longitude" onchange="updatell()">
</td>
</tr>

<tr>
<th colspan="3">Date and time at location for observations</th>
</tr>
<tr>
<td align="CENTER">Date <INPUT type="text" size="10" name="local_date"
    value="" onchange="updatelocal(false)"></td>
<td align="CENTER" colspan="2">
  Civil Time <INPUT type="text" size="8" name= "civil_time" value="" onchange="updatelocal(false)">
  Time Zone <INPUT type="text" size="6" name= "ut_offset" value="" onchange="updatelocal(true)">
  <select name="TZ_WE" onchange="updatelocal(true)">
    <option>West</option>
    <option>East</option>
  </select>
 <input type="checkbox" name="dst_check" value="" onclick="updatelocal(true)">DST
</td>
</tr>

<tr>
<td align="center">Julian Date <input type="text" size="10" name= "julian"
    value="" onchange="jdtozdt()"></td>
<td align="center">
 <select name="sel_time_opt" onchange="rewrite1()">
 <option SELECTED>UTC Time</option>
 <option>Local Time</option>
 <option>Solar Time</option>
 <option>Sidereal Time</option>
 </select>
 <INPUT type="text" size="9" name="sel_time" value="" onchange="noupdate()">
</td>
<td align="center">
 <select name="local_diff_opt" onchange="rewrite1()">
 <option SELECTED>UTC-Civil</option>
 <option SELECTED>UTC-Local</option>
 <option>Civil-Local</option>
 <option>Eqn. of Time</option>
 </select>
 <INPUT type="text" size="9" name="local_diff" value="" onchange="noupdate()">
</td>
</tr>
<tr>
<td colspan="3" align="center">
<input type="button" name="noon" value="Noon" onclick= "set12(true)">
<input type="button" name="midnight" value="Midnight" onclick= "set12(false)">
<input type="button" name="Default" value="Reset" 
       onclick= "argstr = location.search.substring(1,location.search.length);reset1()">
</td>
</tr>
</table>
</form>
</center>


</body></html>
